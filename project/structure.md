# Структура проекта

## Основная структура

```
c:\Projects\userp2pp\
│
├── project/                    # Документация проекта
│   ├── history.md              # История изменений
│   ├── structure.md            # Структура проекта (этот файл)
│   ├── tech.md                 # Используемые технологии
│   └── requests.md             # История запросов пользователя
│
├── src/                        # Исходные файлы
│   ├── app/                    # Компоненты приложения
│   │   ├── cards/              # Модуль управления картами
│   │   │   ├── components/     # Компоненты модуля карт
│   │   │   │   ├── CardTable.tsx                 # Таблица карт
│   │   │   │   ├── CardCreateDialog.tsx          # Диалог создания карты
│   │   │   │   ├── CardEditDialog.tsx            # Диалог редактирования карты
│   │   │   │   ├── CardFilters.tsx               # Фильтры для таблицы карт
│   │   │   │   ├── CardStatsCards.tsx            # Статистика по картам
│   │   │   │   ├── CardPouringsDialog.tsx        # Диалог проливов
│   │   │   │   ├── CardBalancesDialog.tsx        # Диалог балансов
│   │   │   │   └── StatusBadge.tsx               # Компонент отображения статуса
│   │   │   └── page.tsx                          # Страница карт
│   │   └── layout.tsx                            # Основной лейаут приложения
│   │
│   ├── components/             # Общие компоненты
│   │   ├── ui/                 # UI компоненты (shadcn/ui)
│   │   └── AuditLogDialog.tsx  # Диалог истории изменений
│   │
│   ├── server/                 # Серверная часть приложения
│   │   ├── api/                # API-роуты
│   │   │   ├── routers/        # tRPC роутеры
│   │   │   │   ├── cards.ts               # Роутер карт
│   │   │   │   ├── cardPourings.ts        # Роутер проливов
│   │   │   │   ├── cardBalances.ts        # Роутер балансов
│   │   │   │   └── auditLog.ts            # Роутер аудита
│   │   │   └── root.ts                    # Корневой роутер
│   │   ├── auth.ts                        # Настройки аутентификации
│   │   └── db.ts                          # Настройки базы данных
│   │
│   └── trpc/                   # tRPC клиент
│       ├── react.ts            # React-хуки для tRPC
│       └── server.ts           # Серверные настройки tRPC
│
└── prisma/                     # Prisma ORM
    └── schema.prisma           # Схема БД
```

## Описание ключевых компонентов

### Модуль карт (cards)

#### Страница карт (page.tsx)
- Основная страница для управления картами
- Отображает таблицу со всеми картами, статистику, фильтры
- Управляет состоянием пагинации, сортировки и фильтрации

#### Таблица карт (CardTable.tsx)
- Отображает список карт в виде таблицы
- Поддерживает сортировку по столбцам
- Включает действия: редактирование, просмотр проливов, балансов, истории изменений и удаление
- Отображает подробную информацию о каждой карте (номер, статус, банк, баланс и т.д.)

#### Диалог проливов (CardPouringsDialog.tsx)
- Позволяет просматривать историю проливов карты
- Поддерживает добавление новых проливов с указанием суммы, даты, статуса и инкассатора
- Обеспечивает редактирование и удаление существующих проливов
- Включает просмотр истории изменений каждого пролива

#### Диалог балансов (CardBalancesDialog.tsx)
- Позволяет просматривать историю балансов карты
- Поддерживает добавление, редактирование и удаление записей о балансах
- Отображает разницу между начальным и конечным балансом
- Включает просмотр истории изменений каждого баланса

### Серверная часть (server)

#### Роутер карт (cards.ts)
- API для работы с картами
- Поддерживает получение, создание, обновление и удаление карт
- Включает фильтрацию и сортировку

#### Роутер проливов (cardPourings.ts)
- API для работы с проливами
- Позволяет получать, создавать, обновлять и удалять проливы для конкретной карты
- Автоматически обновляет связанные данные карты (общая сумма проливов, снятий)

#### Роутер балансов (cardBalances.ts)
- API для работы с балансами
- Позволяет получать, создавать, обновлять и удалять записи о балансах для карты
- Обновляет данные начального и конечного баланса карты

#### Роутер аудита (auditLog.ts)
- API для работы с историей изменений
- Записывает все изменения сущностей (карт, проливов, балансов)
- Поддерживает пагинацию и фильтрацию по типу сущности и ID
