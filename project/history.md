# История изменений проекта

## 03.04.2025 10:17
- Дополнительно улучшен механизм обновления комментариев в компоненте WorkSessionList:
  - Реализовано мгновенное обновление списка сессий после сохранения комментария, без необходимости перезагрузки страницы
  - Добавлен механизм синхронизации выбранной сессии с обновленным списком
  - Оптимизированы зависимости React-эффектов для отслеживания изменений в комментариях

## 03.04.2025 10:14
- Исправлена проблема с комментариями в компоненте WorkSessionList:
  - Устранено циклическое обновление комментариев при открытии/закрытии диалогового окна
  - Оптимизирована логика работы React-эффектов для предотвращения потери комментариев
  - Исправлено некорректное поведение кнопки, меняющей своё название между "Подробности" и "Редактировать"
  - Добавлен сброс состояния комментария при закрытии диалога
  - Предотвращены ненужные обновления списка до завершения редактирования

## 01.04.2025 18:10
- Реализовано перенаправление пользователей с ролью USERCARDS на страницу /cards:
  - Добавлено поле role в модель пользователя в хранилище auth-store
  - Обновлены методы login и getSession в API-роутере auth для возврата роли пользователя
  - Модифицирован middleware.ts для проверки роли пользователя и перенаправления:
    - Пользователи с ролью USERCARDS перенаправляются на /cards
    - Остальные пользователи перенаправляются на /dashboard как и раньше
  - Обновлена главная страница с учетом различных ролей пользователей
  - Улучшена обработка ошибок при разборе токена аутентификации

## 01.04.2025 18:02
- Исправлен компонент CardStatsCards для корректного отображения числовых данных:
  - Добавлена проверка на null/undefined/string значения
  - Улучшено форматирование валюты для рублей
  - Добавлен новый метод API getStats для получения агрегированных данных
  - Обновлена страница карт для использования нового API-метода

## 01.04.2025 17:55
- Исправлены ошибки с типами данных в API-запросах:
  - Изменен тип cardId с string на number во всех методах роутеров cardBalances и cardPourings
  - Исправлены параметры id в методах update и delete (все id теперь принимаются как number)
  - Исправлены вызовы API в компонентах CardPouringsDialog и CardBalancesDialog (используется Number() вместо parseInt)
- Улучшено форматирование сумм с проверкой на null/undefined значения
- Добавлена пагинация в таблицу карт:
  - Реализована возможность выбора количества отображаемых записей (10/20/50)
  - Добавлены элементы навигации по страницам
  - Отображение номера текущей страницы и общего количества страниц
- Исправлено отображение общих сумм в диалогах проливов и балансов

## 01.04.2025 17:37
- Исправлена ошибка типа entityId в роутере auditLog (изменен с string на number)
- Значительно улучшены диалоговые окна для управления проливами и балансами:
  - Увеличен размер до 900px для более удобного отображения всех данных
  - Добавлены кнопки для редактирования и удаления записей
  - Реализован просмотр истории изменений через AuditLogDialog
  - Добавлены недостающие поля для проливов (инкассатор, начальная и конечная суммы, статус)
  - Улучшено отображение информации о балансах (начальный, конечный, изменение)
- Добавлены всплывающие подсказки для более удобной навигации
- В таблице карт улучшено отображение всех необходимых столбцов

## 01.04.2025 17:32
- Исправлена ошибка фильтрации по полю collectorName
- Изменен запрос в роутере карт: поле collectorName теперь корректно получается из таблицы CardPouring, а не из Card
- Добавлен роутер auditLog для работы с историей изменений сущностей

## 01.04.2025 17:19
- Реализован полный функционал управления проливами и балансами карт
- Добавлены отдельные API-роутеры для работы с проливами и балансами
- Расширена таблица карт с отображением всех необходимых полей (номер карты, телефон, пины, баланс, снятие и т.д.)
- Добавлена визуализация истории проливов и балансов в табличном виде
- Создан улучшенный компонент AuditLogDialog с поддержкой пагинации и русификацией всех полей и значений
- Реализована полная русификация всех полей и значений в логах аудита для удобства пользователей

## 01.04.2025 17:06
- Добавлены компоненты для работы с проливами и балансами карт (CardPouringsDialog, CardBalancesDialog)
- Созданы роутеры API для работы с проливами (cardPouringsRouter) и балансами (cardBalancesRouter)
- Реализован полноценный аудит всех действий с картами, проливами и балансами
- Добавлен компонент Navbar с кнопками выхода из аккаунта и переключения темы
- Исправлена ошибка с пустыми значениями в Select.Item компонентах
- Улучшена таблица карт, добавлены дополнительные столбцы и действия

## 01.04.2025 16:52
- Исправлена ошибка с пустыми значениями в Select компонентах
- Заменены пустые значения `<SelectItem value="">` на `<SelectItem value="all">` во всех фильтрах
- Обновлена логика фильтрации для работы с новыми значениями фильтров

## 01.04.2025 16:50
- Исправлена ошибка в роутере карт: заменено имя поля `pourings` на `cardPouring` в запросе findMany
- Устранена проблема с получением списка карт из-за несоответствия имен полей в схеме Prisma и tRPC запросе

## 01.04.2025 16:40
- Выполнен рефакторинг страницы управления картами
- Заменены компоненты HeroUI на компоненты shadcn/ui
- Реализована модульная структура с разделением на отдельные компоненты:
  - StatusBadge - компонент для отображения статуса карты
  - CardFilters - компонент фильтрации карт
  - CardStatsCards - компонент статистики по картам
  - CardTable - компонент таблицы карт с возможностями сортировки
  - CardCreateDialog - компонент для создания новых карт
  - CardEditDialog - компонент для редактирования существующих карт
  - AuditLogDialog - компонент для просмотра истории изменений
- Исправлены пути импортов с использованием префикса ~/
- Добавлено использование useDebounceValue вместо useDebounce

## 27.03.2025 19:03
- Исправлена проблема с авторизацией TRPC запросов
- Обновлен формат сохраняемого токена авторизации (base64-encoded JSON)
- Реализована проверка авторизации как через заголовки (Bearer token), так и через cookies
- Изменена иконка кнопки "Завершить работу" с StopIcon на PauseIcon

## 27.03.2025 18:55
- Создана главная страница с функционалом дашборда
- Перенастроена система маршрутизации: авторизованные пользователи перенаправляются на главную страницу
- Добавлена кнопка выхода из системы
- Реализовано хранение токена авторизации в cookies для серверной проверки
- Оптимизированы компоненты для работы с сессиями на главной странице

## 27.03.2025 18:50
- Исправлена проблема с авторизацией (заменен query на mutation для логина)
- Улучшен контраст иконок для лучшей видимости на темном фоне
- Добавлена задержка перед перенаправлением после входа для предотвращения ошибок
- Улучшена цветовая схема текста и элементов управления

## 27.03.2025 18:43
- Реализована система авторизации по passCode
- Создана защищенная часть приложения для работы с рабочими сессиями
- Настроены API роутеры для работы с пользователями, сессиями и кабинетами
- Реализован интерфейс для управления рабочими сессиями
- Добавлено отображение транзакций Telegram и Bybit
- Обновлен UI с использованием Sonner вместо Toast

## 27.03.2025 18:32
- Инициализация проекта документации
- Создана базовая структура документационных файлов
